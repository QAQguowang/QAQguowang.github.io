---
title: <<TCP/IP协议>>--ARP协议
date: 2020-01-13 21:13:04
tags:
	- 读书笔记
---

# 地址解析协议

## ARP协议

- 对于`TCP/IP`网络，地址解析协议（`ARP`）提供了一种在IPV4地址和各种网络技术使用的硬件地址之间的映射。

## 直接交付和ARP

- 直接交付发生在一个IP数据报被发送到一个IP地址，而该地址与发送方具有相同IP前缀的情况下。

- 直接交付的流程：

  - `请求主机client`要求TCP建立一条到`匹配主机server`的连接。
  - 通过向匹配主机server发送一个IPV4数据报，TCP尝试向远程主机发送一个连接请求。
  - 假设匹配主机server与请求主机client使用的是相同的网络前缀，数据报可以直接发送到这个地址而不经过任何路由器。
  - 假设以太网兼容地址被用于IPV4子网。ARP便可以将请求主机client的逻辑internet地址转换为对应物理硬件地址。ARP工作于广播网络时，通过链路层将消息交付到请求主机client连接的所有网络设备。
  - ARP向所有主机发送一个称为ARP请求的以太网帧，这个过程被称为**链路层广播**。
  - 同一广播域中的所有系统可以接收ARP请求。如果某个系统使用了请求主机client所请求的IPV4地址，它仅需要响应一个ARP应答，便可以将应答发送给请求主机client，这个应答通常不是广播，而仅是发送给请求主机。
  - 匹配主机server学习IPV4到MAC地址的映射，并记录在内存中，供以后使用。

  ![img](https://img-blog.csdnimg.cn/2019071710063232.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNDUzMjg1,size_16,color_FFFFFF,t_70)

## ARP缓存和ARP缓存超时

- ARP缓存
  - ARP高效运行的关键是维护每个主机和路由器上的ARP缓存。该缓存使用地址解析为每个接口维护从网络层地址到硬件地址的最新映射。
- ARP缓存超时
  - 在大多数现实中，完整条目的超时为20分钟，而不完整条目的超时时间为3分钟。
  - 可以通过命令行手动更改超时时间，超时时间最多维持到设备关机。

## ARP帧格式

- ARP帧的示意图

  ![img](https://pic002.cnblogs.com/images/2012/392443/2012041215590890.jpg)

  - 硬件类型
  - 协议类型
  - 硬件地址长度：6
  - 协议地址长度：4
  - `op` ：操作是ARP请求（值为1）、ARP应答（值为2）、RARP请求（值为3）或 RARP应答（值为4）。

## ARP相关的攻击

- `ARP泛洪攻击`：通过向网关发送大量ARP报文，导致网关无法正常响应。
- `ARP欺骗主机攻击`：攻击者通过ARP欺骗使得局域网内被攻击主机发送给网关的流量信息实际上都发送给攻击者。
- `欺骗网关攻击`：欺骗网关就是把别的主机发送给网关的数据通过欺骗网关的形式使得这些数据通过网关发送给攻击者。
- `中间人攻击`：中间人攻击是同时欺骗局域网内的主机和网关，局域网中用户的数据和网关的数据会发给同一个攻击者，这样，用户与网关的数据就会泄露。
- `IP地址冲突攻击`：通过对局域网中的物理主机进行扫描，扫描出局域网中的物理主机的MAC地址，然后根据物理主机的MAC进行攻击，导致局域网内的主机产生IP地址冲突，影响用户的网络正常使用。 











